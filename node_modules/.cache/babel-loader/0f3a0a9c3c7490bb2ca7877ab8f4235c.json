{"ast":null,"code":"\"use strict\"; // Copyright 2019-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar DefaultAudioVideoController_1 = require(\"../audiovideocontroller/DefaultAudioVideoController\");\n\nvar DefaultAudioVideoFacade_1 = require(\"../audiovideofacade/DefaultAudioVideoFacade\");\n\nvar FullJitterBackoff_1 = require(\"../backoff/FullJitterBackoff\");\n\nvar DefaultBrowserBehavior_1 = require(\"../browserbehavior/DefaultBrowserBehavior\");\n\nvar ContentShareMediaStreamBroker_1 = require(\"../contentsharecontroller/ContentShareMediaStreamBroker\");\n\nvar DefaultContentShareController_1 = require(\"../contentsharecontroller/DefaultContentShareController\");\n\nvar DefaultReconnectController_1 = require(\"../reconnectcontroller/DefaultReconnectController\");\n\nvar DefaultScreenShareFacade_1 = require(\"../screensharefacade/DefaultScreenShareFacade\");\n\nvar DefaultScreenShareViewFacade_1 = require(\"../screenshareviewfacade/DefaultScreenShareViewFacade\");\n\nvar DefaultWebSocketAdapter_1 = require(\"../websocketadapter/DefaultWebSocketAdapter\");\n\nvar DefaultMeetingSession =\n/** @class */\nfunction () {\n  function DefaultMeetingSession(configuration, logger, deviceController) {\n    this._configuration = configuration;\n    this._logger = logger;\n    this.checkBrowserSupportAndFeatureConfiguration();\n    this._deviceController = deviceController;\n\n    this._deviceController.enableWebAudio(configuration.enableWebAudio);\n\n    this.audioVideoController = new DefaultAudioVideoController_1.default(this._configuration, this._logger, new DefaultWebSocketAdapter_1.default(this._logger), deviceController, new DefaultReconnectController_1.default(DefaultMeetingSession.RECONNECT_TIMEOUT_MS, new FullJitterBackoff_1.default(DefaultMeetingSession.RECONNECT_FIXED_WAIT_MS, DefaultMeetingSession.RECONNECT_SHORT_BACKOFF_MS, DefaultMeetingSession.RECONNECT_LONG_BACKOFF_MS)));\n    deviceController.bindToAudioVideoController(this.audioVideoController);\n    this.screenShareFacade = new DefaultScreenShareFacade_1.default(this._configuration, this._logger, deviceController);\n    this.screenShareViewFacade = new DefaultScreenShareViewFacade_1.default(this._configuration, this._logger);\n    var contentShareMediaStreamBroker = new ContentShareMediaStreamBroker_1.default(this._logger);\n    this.contentShareController = new DefaultContentShareController_1.default(contentShareMediaStreamBroker, new DefaultAudioVideoController_1.default(DefaultContentShareController_1.default.createContentShareMeetingSessionConfigure(this._configuration), this._logger, new DefaultWebSocketAdapter_1.default(this._logger), contentShareMediaStreamBroker, new DefaultReconnectController_1.default(DefaultMeetingSession.RECONNECT_TIMEOUT_MS, new FullJitterBackoff_1.default(DefaultMeetingSession.RECONNECT_FIXED_WAIT_MS, DefaultMeetingSession.RECONNECT_SHORT_BACKOFF_MS, DefaultMeetingSession.RECONNECT_LONG_BACKOFF_MS))), this.audioVideoController);\n    this.audioVideoFacade = new DefaultAudioVideoFacade_1.default(this.audioVideoController, this.audioVideoController.videoTileController, this.audioVideoController.realtimeController, this.audioVideoController.audioMixController, this._deviceController, this.contentShareController);\n  }\n\n  Object.defineProperty(DefaultMeetingSession.prototype, \"configuration\", {\n    get: function () {\n      return this._configuration;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DefaultMeetingSession.prototype, \"logger\", {\n    get: function () {\n      return this._logger;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DefaultMeetingSession.prototype, \"audioVideo\", {\n    get: function () {\n      return this.audioVideoFacade;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DefaultMeetingSession.prototype, \"contentShare\", {\n    get: function () {\n      return this.contentShareController;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DefaultMeetingSession.prototype, \"screenShare\", {\n    get: function () {\n      return this.screenShareFacade;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DefaultMeetingSession.prototype, \"screenShareView\", {\n    get: function () {\n      return this.screenShareViewFacade;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(DefaultMeetingSession.prototype, \"deviceController\", {\n    get: function () {\n      return this._deviceController;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  DefaultMeetingSession.prototype.checkBrowserSupportAndFeatureConfiguration = function () {\n    var browserBehavior = new DefaultBrowserBehavior_1.default();\n    var browser = browserBehavior.name() + \" \" + browserBehavior.majorVersion() + \" (\" + browserBehavior.version() + \")\";\n    this.logger.info(\"browser is \" + browser);\n\n    if (!browserBehavior.isSupported()) {\n      this.logger.warn('this browser is not currently supported. ' + 'Stability may suffer. ' + (\"Supported browsers are: \" + browserBehavior.supportString() + \".\"));\n    }\n\n    if (this._configuration.enableUnifiedPlanForChromiumBasedBrowsers) {\n      if (browserBehavior.hasChromiumWebRTC()) {\n        this.logger.info('WebRTC unified plan for Chromium-based browsers is enabled');\n      } else {\n        this.logger.info(\"WebRTC unified plan is required for \" + browserBehavior.name());\n      }\n    }\n\n    if (this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers) {\n      if (!this._configuration.enableUnifiedPlanForChromiumBasedBrowsers) {\n        this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers = false;\n        this.logger.info('Simulcast requires enabling WebRTC Unified Plan for Chromium-based browsers');\n      } else if (browserBehavior.hasChromiumWebRTC()) {\n        this.logger.info(\"Simulcast is enabled for \" + browserBehavior.name());\n      } else {\n        this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers = false;\n        this.logger.info('Simulcast requires WebRTC Unified Plan and is only supported on Chromium-based browsers');\n      }\n    }\n  };\n\n  DefaultMeetingSession.RECONNECT_TIMEOUT_MS = 120 * 1000;\n  DefaultMeetingSession.RECONNECT_FIXED_WAIT_MS = 0;\n  DefaultMeetingSession.RECONNECT_SHORT_BACKOFF_MS = 1 * 1000;\n  DefaultMeetingSession.RECONNECT_LONG_BACKOFF_MS = 5 * 1000;\n  return DefaultMeetingSession;\n}();\n\nexports.default = DefaultMeetingSession;","map":{"version":3,"sources":["../../src/meetingsession/DefaultMeetingSession.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright 2019-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar DefaultAudioVideoController_1 = require(\"../audiovideocontroller/DefaultAudioVideoController\");\nvar DefaultAudioVideoFacade_1 = require(\"../audiovideofacade/DefaultAudioVideoFacade\");\nvar FullJitterBackoff_1 = require(\"../backoff/FullJitterBackoff\");\nvar DefaultBrowserBehavior_1 = require(\"../browserbehavior/DefaultBrowserBehavior\");\nvar ContentShareMediaStreamBroker_1 = require(\"../contentsharecontroller/ContentShareMediaStreamBroker\");\nvar DefaultContentShareController_1 = require(\"../contentsharecontroller/DefaultContentShareController\");\nvar DefaultReconnectController_1 = require(\"../reconnectcontroller/DefaultReconnectController\");\nvar DefaultScreenShareFacade_1 = require(\"../screensharefacade/DefaultScreenShareFacade\");\nvar DefaultScreenShareViewFacade_1 = require(\"../screenshareviewfacade/DefaultScreenShareViewFacade\");\nvar DefaultWebSocketAdapter_1 = require(\"../websocketadapter/DefaultWebSocketAdapter\");\nvar DefaultMeetingSession = /** @class */ (function () {\n    function DefaultMeetingSession(configuration, logger, deviceController) {\n        this._configuration = configuration;\n        this._logger = logger;\n        this.checkBrowserSupportAndFeatureConfiguration();\n        this._deviceController = deviceController;\n        this._deviceController.enableWebAudio(configuration.enableWebAudio);\n        this.audioVideoController = new DefaultAudioVideoController_1.default(this._configuration, this._logger, new DefaultWebSocketAdapter_1.default(this._logger), deviceController, new DefaultReconnectController_1.default(DefaultMeetingSession.RECONNECT_TIMEOUT_MS, new FullJitterBackoff_1.default(DefaultMeetingSession.RECONNECT_FIXED_WAIT_MS, DefaultMeetingSession.RECONNECT_SHORT_BACKOFF_MS, DefaultMeetingSession.RECONNECT_LONG_BACKOFF_MS)));\n        deviceController.bindToAudioVideoController(this.audioVideoController);\n        this.screenShareFacade = new DefaultScreenShareFacade_1.default(this._configuration, this._logger, deviceController);\n        this.screenShareViewFacade = new DefaultScreenShareViewFacade_1.default(this._configuration, this._logger);\n        var contentShareMediaStreamBroker = new ContentShareMediaStreamBroker_1.default(this._logger);\n        this.contentShareController = new DefaultContentShareController_1.default(contentShareMediaStreamBroker, new DefaultAudioVideoController_1.default(DefaultContentShareController_1.default.createContentShareMeetingSessionConfigure(this._configuration), this._logger, new DefaultWebSocketAdapter_1.default(this._logger), contentShareMediaStreamBroker, new DefaultReconnectController_1.default(DefaultMeetingSession.RECONNECT_TIMEOUT_MS, new FullJitterBackoff_1.default(DefaultMeetingSession.RECONNECT_FIXED_WAIT_MS, DefaultMeetingSession.RECONNECT_SHORT_BACKOFF_MS, DefaultMeetingSession.RECONNECT_LONG_BACKOFF_MS))), this.audioVideoController);\n        this.audioVideoFacade = new DefaultAudioVideoFacade_1.default(this.audioVideoController, this.audioVideoController.videoTileController, this.audioVideoController.realtimeController, this.audioVideoController.audioMixController, this._deviceController, this.contentShareController);\n    }\n    Object.defineProperty(DefaultMeetingSession.prototype, \"configuration\", {\n        get: function () {\n            return this._configuration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultMeetingSession.prototype, \"logger\", {\n        get: function () {\n            return this._logger;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultMeetingSession.prototype, \"audioVideo\", {\n        get: function () {\n            return this.audioVideoFacade;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultMeetingSession.prototype, \"contentShare\", {\n        get: function () {\n            return this.contentShareController;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultMeetingSession.prototype, \"screenShare\", {\n        get: function () {\n            return this.screenShareFacade;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultMeetingSession.prototype, \"screenShareView\", {\n        get: function () {\n            return this.screenShareViewFacade;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(DefaultMeetingSession.prototype, \"deviceController\", {\n        get: function () {\n            return this._deviceController;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    DefaultMeetingSession.prototype.checkBrowserSupportAndFeatureConfiguration = function () {\n        var browserBehavior = new DefaultBrowserBehavior_1.default();\n        var browser = browserBehavior.name() + \" \" + browserBehavior.majorVersion() + \" (\" + browserBehavior.version() + \")\";\n        this.logger.info(\"browser is \" + browser);\n        if (!browserBehavior.isSupported()) {\n            this.logger.warn('this browser is not currently supported. ' +\n                'Stability may suffer. ' +\n                (\"Supported browsers are: \" + browserBehavior.supportString() + \".\"));\n        }\n        if (this._configuration.enableUnifiedPlanForChromiumBasedBrowsers) {\n            if (browserBehavior.hasChromiumWebRTC()) {\n                this.logger.info('WebRTC unified plan for Chromium-based browsers is enabled');\n            }\n            else {\n                this.logger.info(\"WebRTC unified plan is required for \" + browserBehavior.name());\n            }\n        }\n        if (this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers) {\n            if (!this._configuration.enableUnifiedPlanForChromiumBasedBrowsers) {\n                this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers = false;\n                this.logger.info('Simulcast requires enabling WebRTC Unified Plan for Chromium-based browsers');\n            }\n            else if (browserBehavior.hasChromiumWebRTC()) {\n                this.logger.info(\"Simulcast is enabled for \" + browserBehavior.name());\n            }\n            else {\n                this._configuration.enableSimulcastForUnifiedPlanChromiumBasedBrowsers = false;\n                this.logger.info('Simulcast requires WebRTC Unified Plan and is only supported on Chromium-based browsers');\n            }\n        }\n    };\n    DefaultMeetingSession.RECONNECT_TIMEOUT_MS = 120 * 1000;\n    DefaultMeetingSession.RECONNECT_FIXED_WAIT_MS = 0;\n    DefaultMeetingSession.RECONNECT_SHORT_BACKOFF_MS = 1 * 1000;\n    DefaultMeetingSession.RECONNECT_LONG_BACKOFF_MS = 5 * 1000;\n    return DefaultMeetingSession;\n}());\nexports.default = DefaultMeetingSession;\n//# sourceMappingURL=DefaultMeetingSession.js.map"]},"metadata":{},"sourceType":"script"}