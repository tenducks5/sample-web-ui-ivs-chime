{"ast":null,"code":"\"use strict\"; // Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar ua_parser_js_1 = require(\"ua-parser-js\");\n\nvar Versioning_1 = require(\"../versioning/Versioning\");\n\nvar DefaultEventController =\n/** @class */\nfunction () {\n  function DefaultEventController(audioVideoController) {\n    var _a, _b, _c, _d, _e, _f, _g;\n\n    this.audioVideoController = audioVideoController;\n    /** @internal */\n\n    this.meetingHistoryStates = [];\n\n    try {\n      this.parserResult = navigator && navigator.userAgent ? new ua_parser_js_1.UAParser(navigator.userAgent).getResult() : null;\n    } catch (error) {\n      audioVideoController.logger.error(error.message);\n    }\n\n    this.browserMajorVersion = ((_c = (_b = (_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.browser) === null || _b === void 0 ? void 0 : _b.version) === null || _c === void 0 ? void 0 : _c.split('.')[0]) || DefaultEventController.UNAVAILABLE;\n    this.browserName = ((_d = this.parserResult) === null || _d === void 0 ? void 0 : _d.browser.name) || DefaultEventController.UNAVAILABLE;\n    this.browserVersion = ((_e = this.parserResult) === null || _e === void 0 ? void 0 : _e.browser.version) || DefaultEventController.UNAVAILABLE;\n    this.deviceName = [((_f = this.parserResult) === null || _f === void 0 ? void 0 : _f.device.vendor) || '', ((_g = this.parserResult) === null || _g === void 0 ? void 0 : _g.device.model) || ''].join(' ').trim() || DefaultEventController.UNAVAILABLE;\n  }\n\n  DefaultEventController.prototype.publishEvent = function (name, attributes) {\n    return __awaiter(this, void 0, void 0, function () {\n      var timestampMs, eventAttributes;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            timestampMs = Date.now();\n            return [4\n            /*yield*/\n            , this.pushMeetingState(name, timestampMs)];\n\n          case 1:\n            _a.sent();\n\n            eventAttributes = Object.freeze(Object.assign(this.getAttributes(timestampMs), attributes));\n            this.audioVideoController.forEachObserver(function (observer) {\n              if (observer.eventDidReceive) {\n                observer.eventDidReceive(name, eventAttributes);\n              }\n            });\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  DefaultEventController.prototype.pushMeetingState = function (state, timestampMs) {\n    if (timestampMs === void 0) {\n      timestampMs = Date.now();\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        this.meetingHistoryStates.push({\n          name: state,\n          timestampMs: timestampMs\n        });\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  DefaultEventController.prototype.getAttributes = function (timestampMs) {\n    var _a, _b;\n\n    return {\n      attendeeId: this.audioVideoController.configuration.credentials.attendeeId,\n      browserMajorVersion: this.browserMajorVersion,\n      browserName: this.browserName,\n      browserVersion: this.browserVersion,\n      deviceName: this.deviceName,\n      externalMeetingId: typeof this.audioVideoController.configuration.externalMeetingId === 'string' ? this.audioVideoController.configuration.externalMeetingId : '',\n      externalUserId: this.audioVideoController.configuration.credentials.externalUserId,\n      meetingHistory: this.meetingHistoryStates,\n      meetingId: this.audioVideoController.configuration.meetingId,\n      osName: ((_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.os.name) || DefaultEventController.UNAVAILABLE,\n      osVersion: ((_b = this.parserResult) === null || _b === void 0 ? void 0 : _b.os.version) || DefaultEventController.UNAVAILABLE,\n      sdkVersion: Versioning_1.default.sdkVersion,\n      sdkName: Versioning_1.default.sdkName,\n      timestampMs: timestampMs\n    };\n  };\n  /** @internal */\n\n\n  DefaultEventController.UNAVAILABLE = 'Unavailable';\n  return DefaultEventController;\n}();\n\nexports.default = DefaultEventController;","map":{"version":3,"sources":["../../src/eventcontroller/DefaultEventController.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ua_parser_js_1 = require(\"ua-parser-js\");\nvar Versioning_1 = require(\"../versioning/Versioning\");\nvar DefaultEventController = /** @class */ (function () {\n    function DefaultEventController(audioVideoController) {\n        var _a, _b, _c, _d, _e, _f, _g;\n        this.audioVideoController = audioVideoController;\n        /** @internal */\n        this.meetingHistoryStates = [];\n        try {\n            this.parserResult =\n                navigator && navigator.userAgent ? new ua_parser_js_1.UAParser(navigator.userAgent).getResult() : null;\n        }\n        catch (error) {\n            audioVideoController.logger.error(error.message);\n        }\n        this.browserMajorVersion =\n            ((_c = (_b = (_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.browser) === null || _b === void 0 ? void 0 : _b.version) === null || _c === void 0 ? void 0 : _c.split('.')[0]) || DefaultEventController.UNAVAILABLE;\n        this.browserName = ((_d = this.parserResult) === null || _d === void 0 ? void 0 : _d.browser.name) || DefaultEventController.UNAVAILABLE;\n        this.browserVersion = ((_e = this.parserResult) === null || _e === void 0 ? void 0 : _e.browser.version) || DefaultEventController.UNAVAILABLE;\n        this.deviceName =\n            [((_f = this.parserResult) === null || _f === void 0 ? void 0 : _f.device.vendor) || '', ((_g = this.parserResult) === null || _g === void 0 ? void 0 : _g.device.model) || '']\n                .join(' ')\n                .trim() || DefaultEventController.UNAVAILABLE;\n    }\n    DefaultEventController.prototype.publishEvent = function (name, attributes) {\n        return __awaiter(this, void 0, void 0, function () {\n            var timestampMs, eventAttributes;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        timestampMs = Date.now();\n                        return [4 /*yield*/, this.pushMeetingState(name, timestampMs)];\n                    case 1:\n                        _a.sent();\n                        eventAttributes = Object.freeze(Object.assign(this.getAttributes(timestampMs), attributes));\n                        this.audioVideoController.forEachObserver(function (observer) {\n                            if (observer.eventDidReceive) {\n                                observer.eventDidReceive(name, eventAttributes);\n                            }\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    DefaultEventController.prototype.pushMeetingState = function (state, timestampMs) {\n        if (timestampMs === void 0) { timestampMs = Date.now(); }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                this.meetingHistoryStates.push({\n                    name: state,\n                    timestampMs: timestampMs,\n                });\n                return [2 /*return*/];\n            });\n        });\n    };\n    DefaultEventController.prototype.getAttributes = function (timestampMs) {\n        var _a, _b;\n        return {\n            attendeeId: this.audioVideoController.configuration.credentials.attendeeId,\n            browserMajorVersion: this.browserMajorVersion,\n            browserName: this.browserName,\n            browserVersion: this.browserVersion,\n            deviceName: this.deviceName,\n            externalMeetingId: typeof this.audioVideoController.configuration.externalMeetingId === 'string'\n                ? this.audioVideoController.configuration.externalMeetingId\n                : '',\n            externalUserId: this.audioVideoController.configuration.credentials.externalUserId,\n            meetingHistory: this.meetingHistoryStates,\n            meetingId: this.audioVideoController.configuration.meetingId,\n            osName: ((_a = this.parserResult) === null || _a === void 0 ? void 0 : _a.os.name) || DefaultEventController.UNAVAILABLE,\n            osVersion: ((_b = this.parserResult) === null || _b === void 0 ? void 0 : _b.os.version) || DefaultEventController.UNAVAILABLE,\n            sdkVersion: Versioning_1.default.sdkVersion,\n            sdkName: Versioning_1.default.sdkName,\n            timestampMs: timestampMs,\n        };\n    };\n    /** @internal */\n    DefaultEventController.UNAVAILABLE = 'Unavailable';\n    return DefaultEventController;\n}());\nexports.default = DefaultEventController;\n//# sourceMappingURL=DefaultEventController.js.map"]},"metadata":{},"sourceType":"script"}