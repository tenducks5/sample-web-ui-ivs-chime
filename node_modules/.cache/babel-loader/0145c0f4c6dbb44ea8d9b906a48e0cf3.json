{"ast":null,"code":"import _objectSpread from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import RemoteVideo from'./RemoteVideo';import*as config from'../../config';import{jsx as _jsx}from\"react/jsx-runtime\";var MAX_REMOTE_VIDEOS=config.CHIME_ROOM_MAX_ATTENDEE;var RemoteVideoGroup=/*#__PURE__*/function(_Component){_inherits(RemoteVideoGroup,_Component);var _super=_createSuper(RemoteVideoGroup);function RemoteVideoGroup(){var _this;_classCallCheck(this,RemoteVideoGroup);_this=_super.call(this);_this.state={rosterChanged:false,roster:[]};_this.findRosterSlot=function(attendeeId){var index;for(index=0;index<_this.state.roster.length;index++){if(_this.state.roster[index].attendeeId===attendeeId){return index;}}for(index=0;index<_this.state.roster.length;index++){if(!_this.state.roster[index].attendeeId){return index;}}return 0;};_this.rosterCallback=function(newRoster){if(Object.keys(newRoster).length>2){if(config.DEBUG)console.log('More than 2');}if(Object.keys(newRoster).length<Object.keys(_this.previousRoster).length){if(config.DEBUG)console.log('Attendee(s) left');var differ=Object.keys(_this.previousRoster).filter(function(k){return _this.previousRoster[k]!==newRoster[k];});if(config.DEBUG)console.log(differ);if(differ.length){var i;for(i in differ){var index=_this.findRosterSlot(differ[i]);var roster=_this.state.roster;roster[index]={videoElement:roster[index].videoElement};_this.setState({roster:roster});}}}_this.previousRoster=Object.assign({},newRoster);var attendeeId;for(attendeeId in newRoster){// Exclude self\nif(attendeeId===_this.props.joinInfo.Attendee.AttendeeId){continue;}// exclude empty name\nif(!newRoster[attendeeId].name){continue;}var _index=_this.findRosterSlot(attendeeId);var _roster=_this.state.roster;var attendee=_objectSpread(_objectSpread({},_roster[_index]),{},{attendeeId:attendeeId},newRoster[attendeeId]);_roster[_index]=attendee;_this.setState({roster:_roster});}};_this.videoTileDidUpdateCallback=function(tileState){if(!tileState.boundAttendeeId||tileState.localTile||tileState.isContent||!tileState.tileId){return;}var index=_this.findRosterSlot(tileState.boundAttendeeId);var roster=_this.state.roster;var attendee=_objectSpread(_objectSpread({},roster[index]),{},{videoEnabled:tileState.active,attendeeId:tileState.boundAttendeeId,tileId:tileState.tileId});roster[index]=attendee;_this.setState({roster:roster});setTimeout(function(){if(config.DEBUG)console.log(roster[index]);var videoElement=document.getElementById(\"video_\".concat(tileState.boundAttendeeId));if(videoElement){_this.props.chime.audioVideo.bindVideoElement(tileState.tileId,videoElement);}},1000);};_this.videoTileWasRemovedCallback=function(tileId){var roster=_this.state.roster;// Find the removed tileId in the roster and mark the video as disabled.\n// eslint-disable-next-line\nroster.find(function(o,i){if(o.tileId===tileId){roster[i].videoEnabled=false;_this.setState({roster:roster});if(config.DEBUG)console.log(\"Tile was removed \".concat(tileId));}});};_this.previousRoster={};return _this;}_createClass(RemoteVideoGroup,[{key:\"componentDidMount\",value:function componentDidMount(){var roster=[];// eslint-disable-next-line\nArray.from(Array(MAX_REMOTE_VIDEOS).keys()).map(function(key,index){roster[index]={videoElement:/*#__PURE__*/React.createRef()};});this.setState({roster:roster});this.props.chime.subscribeToRosterUpdate(this.rosterCallback);this.props.chime.audioVideo.addObserver({videoTileDidUpdate:this.videoTileDidUpdateCallback,videoTileWasRemoved:this.videoTileWasRemovedCallback});}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this.props.chime.unsubscribeFromRosterUpdate(this.rosterCallback);}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsx(React.Fragment,{children:this.state.roster.map(function(attendee,index){return/*#__PURE__*/_jsx(RemoteVideo,{chime:_this2.props.chime,attendeeId:attendee.attendeeId,videoEnabled:attendee.videoEnabled,name:attendee.name,muted:attendee.muted,videoElement:attendee.videoElement},index);})});}}]);return RemoteVideoGroup;}(Component);export default RemoteVideoGroup;","map":{"version":3,"sources":["/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/src/components/chimeWeb/RemoteVideoGroup.jsx"],"names":["React","Component","RemoteVideo","config","MAX_REMOTE_VIDEOS","CHIME_ROOM_MAX_ATTENDEE","RemoteVideoGroup","state","rosterChanged","roster","findRosterSlot","attendeeId","index","length","rosterCallback","newRoster","Object","keys","DEBUG","console","log","previousRoster","differ","filter","k","i","videoElement","setState","assign","props","joinInfo","Attendee","AttendeeId","name","attendee","videoTileDidUpdateCallback","tileState","boundAttendeeId","localTile","isContent","tileId","videoEnabled","active","setTimeout","document","getElementById","chime","audioVideo","bindVideoElement","videoTileWasRemovedCallback","find","o","Array","from","map","key","createRef","subscribeToRosterUpdate","addObserver","videoTileDidUpdate","videoTileWasRemoved","unsubscribeFromRosterUpdate","muted"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport RemoteVideo from './RemoteVideo';\nimport * as config from '../../config';\n\nconst MAX_REMOTE_VIDEOS = config.CHIME_ROOM_MAX_ATTENDEE;\n\nclass RemoteVideoGroup extends Component {\n\n  state = {\n    rosterChanged: false,\n    roster: []\n  }\n\n  constructor() {\n    super();\n    this.previousRoster = {};\n  }\n\n  findRosterSlot = (attendeeId) => {\n    let index;\n    for (index = 0; index < this.state.roster.length; index++) {\n      if (this.state.roster[index].attendeeId === attendeeId) {\n        return index;\n      }\n    }\n    for (index = 0; index < this.state.roster.length; index++) {\n      if (!this.state.roster[index].attendeeId) {\n        return index;\n      }\n    }\n    return 0;\n  }\n\n  rosterCallback = (newRoster) => {\n\n    if (Object.keys(newRoster).length > 2) {\n      if (config.DEBUG) console.log('More than 2');\n    }\n\n    if (Object.keys(newRoster).length < Object.keys(this.previousRoster).length) {\n      if (config.DEBUG) console.log('Attendee(s) left');\n      const differ = Object.keys(this.previousRoster).filter(k => this.previousRoster[k] !== newRoster[k]);\n      if (config.DEBUG) console.log(differ);\n\n      if (differ.length) {\n        let i;\n        for (i in differ) {\n          const index = this.findRosterSlot(differ[i]);\n          const roster = this.state.roster;\n          roster[index] = {\n            videoElement: roster[index].videoElement\n          }\n          this.setState({ roster });\n        }\n      }\n    }\n\n    this.previousRoster = Object.assign({}, newRoster);\n\n    let attendeeId;\n    for (attendeeId in newRoster) {\n\n      // Exclude self\n      if (attendeeId === this.props.joinInfo.Attendee.AttendeeId) {\n        continue;\n      }\n\n      // exclude empty name\n      if (!newRoster[attendeeId].name) {\n        continue;\n      }\n\n      const index = this.findRosterSlot(attendeeId);\n      const roster = this.state.roster;\n      const attendee = {\n        ...roster[index],\n        attendeeId,\n        ...newRoster[attendeeId]\n      };\n\n      roster[index] = attendee;\n      this.setState({ roster });\n    }\n  };\n\n  videoTileDidUpdateCallback = (tileState) => {\n    if (\n      !tileState.boundAttendeeId ||\n      tileState.localTile ||\n      tileState.isContent ||\n      !tileState.tileId\n    ) {\n      return;\n    }\n\n    let index = this.findRosterSlot(tileState.boundAttendeeId);\n    const roster = this.state.roster;\n    const attendee = {\n      ...roster[index],\n      videoEnabled: tileState.active,\n      attendeeId: tileState.boundAttendeeId,\n      tileId: tileState.tileId\n    };\n    roster[index] = attendee;\n    this.setState({ roster });\n\n    setTimeout(() => {\n      if (config.DEBUG) console.log(roster[index]);\n      const videoElement = document.getElementById(`video_${tileState.boundAttendeeId}`);\n      if (videoElement) {\n        this.props.chime.audioVideo.bindVideoElement(\n          tileState.tileId,\n          videoElement\n        );\n      }\n    }, 1000);\n  };\n\n  videoTileWasRemovedCallback = (tileId) => {\n    let roster = this.state.roster;\n\n    // Find the removed tileId in the roster and mark the video as disabled.\n    // eslint-disable-next-line\n    roster.find((o, i) => {\n      if (o.tileId === tileId) {\n        roster[i].videoEnabled = false;\n        this.setState({ roster });\n        if (config.DEBUG) console.log(`Tile was removed ${tileId}`);\n      }\n    });\n  }\n\n  componentDidMount() {\n    const roster = [];\n    // eslint-disable-next-line\n    Array.from(Array(MAX_REMOTE_VIDEOS).keys()).map((key, index) => {\n      roster[index] = {\n        videoElement: React.createRef()\n      };\n    });\n    this.setState({ roster });\n\n    this.props.chime.subscribeToRosterUpdate(this.rosterCallback);\n\n    this.props.chime.audioVideo.addObserver({\n      videoTileDidUpdate: this.videoTileDidUpdateCallback,\n      videoTileWasRemoved: this.videoTileWasRemovedCallback,\n    });\n  }\n\n  componentWillUnmount() {\n    this.props.chime.unsubscribeFromRosterUpdate(this.rosterCallback);\n  }\n\n  render() {\n    return(\n      <React.Fragment>\n        {this.state.roster.map((attendee, index) => {\n          return (\n            <RemoteVideo\n              chime={this.props.chime}\n              key={index}\n              attendeeId={attendee.attendeeId}\n              videoEnabled={attendee.videoEnabled}\n              name={attendee.name}\n              muted={attendee.muted}\n              videoElement={attendee.videoElement}\n            />\n          );\n        })}\n      </React.Fragment>\n    )\n  }\n}\n\nRemoteVideoGroup.propTypes = {\n  chime: PropTypes.object,\n  joinInfo: PropTypes.object\n};\n\nexport default RemoteVideoGroup;\n"]},"metadata":{},"sourceType":"module"}