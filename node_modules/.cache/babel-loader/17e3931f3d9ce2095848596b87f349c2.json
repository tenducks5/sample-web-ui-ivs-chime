{"ast":null,"code":"\"use strict\"; // Copyright 2019-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Maybe_1 = require(\"../../maybe/Maybe\");\n\nvar ScreenSignalingSessionEventType_1 = require(\"../../screensignalingsession/ScreenSignalingSessionEventType\");\n\nvar DefaultSignalingSession =\n/** @class */\nfunction () {\n  function DefaultSignalingSession(screenSignalingSessionFactory) {\n    this.screenSignalingSessionFactory = screenSignalingSessionFactory;\n    this.DEFAULT_TIMEOUT_MS = 500;\n    this.observers = new Set();\n  }\n\n  DefaultSignalingSession.prototype.open = function (connectionRequest) {\n    var _this = this;\n\n    if (this.session) {\n      return Promise.reject(new Error('Must close connection before opening another'));\n    }\n\n    this.session = this.screenSignalingSessionFactory.create(connectionRequest.screenDataURL, connectionRequest.sessionToken);\n    this.session.addEventListener(ScreenSignalingSessionEventType_1.default.StreamStart, function (event) {\n      _this.observers.forEach(function (observer) {\n        Maybe_1.default.of(observer.streamDidStart).map(function (f) {\n          return f(event.detail);\n        });\n      });\n    });\n    this.session.addEventListener(ScreenSignalingSessionEventType_1.default.StreamEnd, function (event) {\n      _this.observers.forEach(function (observer) {\n        Maybe_1.default.of(observer.streamDidStop).map(function (f) {\n          return f(event.detail);\n        });\n      });\n    });\n    this.session.addEventListener(ScreenSignalingSessionEventType_1.default.StreamSwitch, function (event) {\n      _this.observers.forEach(function (observer) {\n        return Maybe_1.default.of(observer.streamDidSwitch).map(function (f) {\n          return f(event.detail);\n        });\n      });\n    });\n    return this.session.open(connectionRequest.timeoutMs).then(function () {});\n  };\n\n  DefaultSignalingSession.prototype.close = function () {\n    if (!this.session) {\n      return Promise.resolve();\n    }\n\n    var session = this.session;\n    this.session = null;\n    return session.close(this.DEFAULT_TIMEOUT_MS).then(function () {});\n  };\n\n  DefaultSignalingSession.prototype.registerObserver = function (observer) {\n    this.observers.add(observer);\n  };\n\n  DefaultSignalingSession.prototype.unregisterObserver = function (observer) {\n    this.observers.delete(observer);\n  };\n\n  return DefaultSignalingSession;\n}();\n\nexports.default = DefaultSignalingSession;","map":{"version":3,"sources":["../../../src/screenviewing/signalingsession/DefaultSignalingSession.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright 2019-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Maybe_1 = require(\"../../maybe/Maybe\");\nvar ScreenSignalingSessionEventType_1 = require(\"../../screensignalingsession/ScreenSignalingSessionEventType\");\nvar DefaultSignalingSession = /** @class */ (function () {\n    function DefaultSignalingSession(screenSignalingSessionFactory) {\n        this.screenSignalingSessionFactory = screenSignalingSessionFactory;\n        this.DEFAULT_TIMEOUT_MS = 500;\n        this.observers = new Set();\n    }\n    DefaultSignalingSession.prototype.open = function (connectionRequest) {\n        var _this = this;\n        if (this.session) {\n            return Promise.reject(new Error('Must close connection before opening another'));\n        }\n        this.session = this.screenSignalingSessionFactory.create(connectionRequest.screenDataURL, connectionRequest.sessionToken);\n        this.session.addEventListener(ScreenSignalingSessionEventType_1.default.StreamStart, function (event) {\n            _this.observers.forEach(function (observer) {\n                Maybe_1.default.of(observer.streamDidStart).map(function (f) { return f(event.detail); });\n            });\n        });\n        this.session.addEventListener(ScreenSignalingSessionEventType_1.default.StreamEnd, function (event) {\n            _this.observers.forEach(function (observer) {\n                Maybe_1.default.of(observer.streamDidStop).map(function (f) { return f(event.detail); });\n            });\n        });\n        this.session.addEventListener(ScreenSignalingSessionEventType_1.default.StreamSwitch, function (event) {\n            _this.observers.forEach(function (observer) {\n                return Maybe_1.default.of(observer.streamDidSwitch).map(function (f) { return f(event.detail); });\n            });\n        });\n        return this.session.open(connectionRequest.timeoutMs).then(function () { });\n    };\n    DefaultSignalingSession.prototype.close = function () {\n        if (!this.session) {\n            return Promise.resolve();\n        }\n        var session = this.session;\n        this.session = null;\n        return session.close(this.DEFAULT_TIMEOUT_MS).then(function () { });\n    };\n    DefaultSignalingSession.prototype.registerObserver = function (observer) {\n        this.observers.add(observer);\n    };\n    DefaultSignalingSession.prototype.unregisterObserver = function (observer) {\n        this.observers.delete(observer);\n    };\n    return DefaultSignalingSession;\n}());\nexports.default = DefaultSignalingSession;\n//# sourceMappingURL=DefaultSignalingSession.js.map"]},"metadata":{},"sourceType":"script"}