{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{withRouter}from'react-router-dom';import*as config from'../../config';import{MeetingSessionStatusCode}from'amazon-chime-sdk-js';// Components\nimport VideoPlayer from'../videoPlayer/VideoPlayer';import Chat from'../chat/Chat';import Controls from'./Controls';import Settings from'./Settings';import LocalVideo from'./LocalVideo';import RemoteVideoGroup from'./RemoteVideoGroup';import Error from'./Error';// Styles\nimport'./ChimeWeb.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Meeting=/*#__PURE__*/function(_Component){_inherits(Meeting,_Component);var _super=_createSuper(Meeting);function Meeting(){var _this;_classCallCheck(this,Meeting);_this=_super.call(this);_this.state={meetingStatus:null,// Loading, Success or Failed\nshowSettings:false,showError:false,errorMsg:''};_this.openSettings=function(){_this.setState({showSettings:true});};_this.closeSettings=function(){_this.setState({showSettings:false});};_this.handleClick=function(e){var showSettings=_this.state.showSettings;if(showSettings){var node=e.target;var isModal=false;while(node){if(node&&node.classList&&node.classList.contains('modal__el')){isModal=true;break;}node=node.parentNode;}if(!isModal){_this.setState({showSettings:false});}}};_this.saveSettings=function(playbackURL,currentAudioInputDevice,currentAudioOutputDevice,currentVideoInputDevice){_this.setState({showSettings:false,currentAudioInputDevice:currentAudioInputDevice,currentAudioOutputDevice:currentAudioOutputDevice,currentVideoInputDevice:currentVideoInputDevice});};_this.setMetadataId=function(metadataId){_this.setState({metadataId:metadataId});};_this.setErrorMsg=function(errorMsg){_this.setState({errorMsg:errorMsg,showError:true});};_this.closeError=function(){_this.setState({showError:false});};_this.layout=function(){if(_this.state.meetingStatus!=='Success'){return;}return/*#__PURE__*/_jsxs(\"div\",{className:\"app-grid\",onClick:_this.handleClick,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"main-stage\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"cams pos-relative\",children:[/*#__PURE__*/_jsx(LocalVideo,{chime:_this.props.chime,joinInfo:_this.joinInfo}),/*#__PURE__*/_jsx(RemoteVideoGroup,{chime:_this.props.chime,joinInfo:_this.joinInfo})]}),/*#__PURE__*/_jsx(VideoPlayer,{setMetadataId:_this.setMetadataId,videoStream:_this.playbackURL}),/*#__PURE__*/_jsx(Controls,{chime:_this.props.chime,baseHref:_this.baseHref,ssName:_this.ssName,title:_this.title,openSettings:_this.openSettings,role:_this.role,history:_this.props.history,myVideoElement:_this.myVideoElement})]}),/*#__PURE__*/_jsx(Chat,{chime:_this.props.chime,title:_this.title,username:_this.username,joinInfo:_this.joinInfo}),_this.state.showSettings&&/*#__PURE__*/_jsx(Settings,{chime:_this.props.chime,joinInfo:_this.joinInfo,saveSettings:_this.saveSettings})]});};_this.baseHref=config.BASE_HREF;_this.ssName='';_this.audioElementRef=/*#__PURE__*/React.createRef();_this.myVideoElement=/*#__PURE__*/React.createRef();return _this;}_createClass(Meeting,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var start=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var qs,room,ssData,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;qs=new URLSearchParams(_this2.props.location.search);room=qs.get('room');_this2.ssName=\"chime[\".concat(room,\"]\");if(!room||!sessionStorage.getItem(_this2.ssName)){_this2.props.history.push(\"\".concat(_this2.baseHref,\"/\"));}ssData=JSON.parse(sessionStorage.getItem(_this2.ssName));if(config.DEBUG)console.log(ssData);_this2.username=ssData.username;_this2.title=ssData.title;_this2.role=ssData.role;if(ssData.joinInfo){_context2.next=19;break;}_context2.next=13;return _this2.props.chime.createRoom(_this2.role,_this2.username,_this2.title,ssData.playbackURL);case 13:_this2.joinInfo=_context2.sent;data=_objectSpread(_objectSpread({},ssData),{},{joinInfo:_this2.joinInfo});sessionStorage.setItem(_this2.ssName,JSON.stringify(data));_this2.playbackURL=_this2.joinInfo.PlaybackURL;_context2.next=23;break;case 19:// Browser refresh\n_this2.joinInfo=ssData.joinInfo;_this2.playbackURL=ssData.joinInfo.PlaybackURL;_context2.next=23;return _this2.props.chime.reInitializeMeetingSession(_this2.joinInfo,_this2.username);case 23:_this2.setState({meetingStatus:'Success'});_this2.props.chime.audioVideo.addObserver({audioVideoDidStop:function(){var _audioVideoDidStop=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(sessionStatus){var whereTo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(sessionStatus.statusCode()===MeetingSessionStatusCode.AudioCallEnded){whereTo=\"\".concat(_this2.baseHref,\"/\").concat(_this2.role==='host'?'':'end');_this2.props.chime.leaveRoom(_this2.role==='host');_this2.props.history.push(whereTo);}case 1:case\"end\":return _context.stop();}}},_callee);}));function audioVideoDidStop(_x){return _audioVideoDidStop.apply(this,arguments);}return audioVideoDidStop;}()});_context2.next=27;return _this2.props.chime.joinRoom(_this2.audioElementRef.current);case 27:_context2.next=33;break;case 29:_context2.prev=29;_context2.t0=_context2[\"catch\"](0);// eslint-disable-next-line\nconsole.error(_context2.t0);_this2.setState({meetingStatus:'Failed'});case 33:case\"end\":return _context2.stop();}}},_callee2,null,[[0,29]]);}));return function start(){return _ref.apply(this,arguments);};}();start();}/*\n   * Settings\n   */},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(\"audio\",{ref:this.audioElementRef,style:{display:'none'}}),this.layout(),this.state.showError&&/*#__PURE__*/_jsx(Error,{closeError:this.closeError,errorMsg:this.state.errorMsg})]});}}]);return Meeting;}(Component);export default withRouter(Meeting);","map":{"version":3,"sources":["/Users/sykang/Documents/Git/amazon-ivs-chime-web-demo/web-ui/src/components/chimeWeb/Meeting.jsx"],"names":["React","Component","withRouter","config","MeetingSessionStatusCode","VideoPlayer","Chat","Controls","Settings","LocalVideo","RemoteVideoGroup","Error","Meeting","state","meetingStatus","showSettings","showError","errorMsg","openSettings","setState","closeSettings","handleClick","e","node","target","isModal","classList","contains","parentNode","saveSettings","playbackURL","currentAudioInputDevice","currentAudioOutputDevice","currentVideoInputDevice","setMetadataId","metadataId","setErrorMsg","closeError","layout","props","chime","joinInfo","baseHref","ssName","title","role","history","myVideoElement","username","BASE_HREF","audioElementRef","createRef","start","qs","URLSearchParams","location","search","room","get","sessionStorage","getItem","push","ssData","JSON","parse","DEBUG","console","log","createRoom","data","setItem","stringify","PlaybackURL","reInitializeMeetingSession","audioVideo","addObserver","audioVideoDidStop","sessionStatus","statusCode","AudioCallEnded","whereTo","leaveRoom","joinRoom","current","error","display"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { withRouter } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport * as config from '../../config';\n\nimport {\n  MeetingSessionStatusCode\n} from 'amazon-chime-sdk-js';\n\n// Components\nimport VideoPlayer from '../videoPlayer/VideoPlayer';\nimport Chat from '../chat/Chat';\nimport Controls from './Controls';\nimport Settings from './Settings';\nimport LocalVideo from './LocalVideo';\nimport RemoteVideoGroup from './RemoteVideoGroup';\nimport Error from './Error';\n\n// Styles\nimport './ChimeWeb.css';\n\nclass Meeting extends Component {\n\n  state = {\n    meetingStatus: null, // Loading, Success or Failed\n    showSettings: false,\n\n    showError: false,\n    errorMsg: '',\n  }\n\n  constructor() {\n    super();\n\n    this.baseHref = config.BASE_HREF;\n    this.ssName = '';\n\n    this.audioElementRef = React.createRef();\n    this.myVideoElement = React.createRef();\n  }\n\n  componentDidMount() {\n\n    const start = async () => {\n      try {\n\n        const qs = new URLSearchParams(this.props.location.search);\n        const room = qs.get('room');\n        this.ssName = `chime[${room}]`;\n        if (!room || !sessionStorage.getItem(this.ssName)) {\n          this.props.history.push(`${this.baseHref}/`);\n        }\n\n        const ssData = JSON.parse(sessionStorage.getItem(this.ssName));\n        if (config.DEBUG) console.log(ssData);\n\n        this.username = ssData.username;\n        this.title = ssData.title;\n        this.role = ssData.role;\n\n        if (!ssData.joinInfo) {\n          this.joinInfo = await this.props.chime.createRoom(this.role, this.username, this.title, ssData.playbackURL);\n          const data = {\n            ...ssData,\n            joinInfo: this.joinInfo\n          }\n          sessionStorage.setItem(this.ssName, JSON.stringify(data));\n          this.playbackURL = this.joinInfo.PlaybackURL;\n        } else {\n          // Browser refresh\n          this.joinInfo = ssData.joinInfo;\n          this.playbackURL = ssData.joinInfo.PlaybackURL;\n          await this.props.chime.reInitializeMeetingSession(this.joinInfo, this.username);\n        }\n\n        this.setState({ meetingStatus: 'Success' });\n\n        this.props.chime.audioVideo.addObserver({\n          audioVideoDidStop: async (sessionStatus) => {\n            if (sessionStatus.statusCode() === MeetingSessionStatusCode.AudioCallEnded) {\n              const whereTo = `${this.baseHref}/${this.role === 'host' ? '' : 'end'}`;\n              this.props.chime.leaveRoom(this.role === 'host');\n              this.props.history.push(whereTo);\n            }\n          }\n        });\n\n        await this.props.chime.joinRoom(this.audioElementRef.current);\n      } catch (error) {\n        // eslint-disable-next-line\n        console.error(error);\n        this.setState({ meetingStatus: 'Failed' });\n      }\n    };\n    start();\n  }\n\n  /*\n   * Settings\n   */\n\n  openSettings = () => {\n    this.setState({ showSettings: true });\n  }\n\n  closeSettings = () => {\n    this.setState({ showSettings: false });\n  }\n\n  handleClick = (e) => {\n    const { showSettings } = this.state;\n    if (showSettings) {\n      let node = e.target;\n      let isModal = false;\n      while (node) {\n        if (node && node.classList && node.classList.contains('modal__el')) {\n          isModal = true;\n          break;\n        }\n        node = node.parentNode;\n      }\n      if (!isModal) {\n        this.setState({ showSettings: false });\n      }\n    }\n  }\n\n  saveSettings = (playbackURL, currentAudioInputDevice, currentAudioOutputDevice, currentVideoInputDevice) => {\n    this.setState({\n      showSettings: false,\n      currentAudioInputDevice,\n      currentAudioOutputDevice,\n      currentVideoInputDevice\n    });\n  }\n\n  setMetadataId = (metadataId) => {\n    this.setState({ metadataId });\n  }\n\n  setErrorMsg = errorMsg => {\n    this.setState({ errorMsg, showError: true });\n  }\n\n  closeError = () => {\n    this.setState({ showError: false });\n  }\n\n  layout = () => {\n    if(this.state.meetingStatus !== 'Success') {\n      return;\n    }\n\n    return (\n      <div className=\"app-grid\" onClick={this.handleClick}>\n        <div className=\"main-stage\">\n          <div className=\"cams pos-relative\">\n          <LocalVideo\n            chime={this.props.chime}\n            joinInfo={this.joinInfo}\n          />\n          <RemoteVideoGroup\n            chime={this.props.chime}\n            joinInfo={this.joinInfo}\n          />\n          </div>\n          <VideoPlayer\n            setMetadataId={this.setMetadataId}\n            videoStream={this.playbackURL}\n          />\n          <Controls\n            chime={this.props.chime}\n            baseHref={this.baseHref}\n            ssName={this.ssName}\n            title={this.title}\n            openSettings={this.openSettings}\n            role={this.role}\n            history={this.props.history}\n            myVideoElement={this.myVideoElement}\n          />\n        </div>\n        <Chat\n          chime={this.props.chime}\n          title={this.title}\n          username={this.username}\n          joinInfo={this.joinInfo}\n        />\n        {this.state.showSettings && (\n          <Settings\n            chime={this.props.chime}\n            joinInfo={this.joinInfo}\n            saveSettings={this.saveSettings}\n          />\n        )}\n      </div>\n    )\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n\n        <audio ref={this.audioElementRef} style={{ display: 'none' }} />\n\n        {this.layout()}\n\n        {this.state.showError && (\n          <Error\n            closeError={this.closeError}\n            errorMsg={this.state.errorMsg}\n          />\n        )}\n      </React.Fragment>\n    )\n  }\n}\n\nMeeting.propTypes = {\n  chime: PropTypes.object\n};\n\nexport default withRouter(Meeting);\n"]},"metadata":{},"sourceType":"module"}