{"ast":null,"code":"\"use strict\"; // Copyright 2019-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Versioning_1 = require(\"../versioning/Versioning\");\n\nvar WebSocketReadyState_1 = require(\"./WebSocketReadyState\");\n\nvar DefaultWebSocketAdapter =\n/** @class */\nfunction () {\n  function DefaultWebSocketAdapter(logger) {\n    this.logger = logger;\n  }\n\n  DefaultWebSocketAdapter.prototype.create = function (url, protocols) {\n    this.connection = new WebSocket(Versioning_1.default.urlWithVersion(url), protocols);\n    this.connection.binaryType = 'arraybuffer';\n  };\n\n  DefaultWebSocketAdapter.prototype.send = function (message) {\n    var _this = this;\n\n    try {\n      this.connection.send(message.buffer);\n      return true;\n    } catch (err) {\n      this.logger.debug(function () {\n        return \"send error: \" + err.message + \", websocket state=\" + WebSocketReadyState_1.default[_this.readyState()];\n      });\n      return false;\n    }\n  };\n\n  DefaultWebSocketAdapter.prototype.close = function (code, reason) {\n    this.connection.close(code, reason);\n  };\n\n  DefaultWebSocketAdapter.prototype.destroy = function () {\n    this.connection = null;\n  };\n\n  DefaultWebSocketAdapter.prototype.addEventListener = function (handler, eventListener) {\n    this.connection.addEventListener(handler, eventListener);\n  };\n\n  DefaultWebSocketAdapter.prototype.readyState = function () {\n    if (!this.connection) {\n      return WebSocketReadyState_1.default.None;\n    }\n\n    switch (this.connection.readyState) {\n      case WebSocket.CONNECTING:\n        return WebSocketReadyState_1.default.Connecting;\n\n      case WebSocket.OPEN:\n        return WebSocketReadyState_1.default.Open;\n\n      case WebSocket.CLOSING:\n        return WebSocketReadyState_1.default.Closing;\n\n      case WebSocket.CLOSED:\n        return WebSocketReadyState_1.default.Closed;\n    }\n  };\n\n  return DefaultWebSocketAdapter;\n}();\n\nexports.default = DefaultWebSocketAdapter;","map":{"version":3,"sources":["../../src/websocketadapter/DefaultWebSocketAdapter.ts"],"names":[],"mappings":"cAAA;AACA;;;;;;AAGA,IAAA,YAAA,GAAA,OAAA,CAAA,0BAAA,CAAA;;AAEA,IAAA,qBAAA,GAAA,OAAA,CAAA,uBAAA,CAAA;;AAEA,IAAA,uBAAA;AAAA;AAAA,YAAA;AAGE,WAAA,uBAAA,CAAoB,MAApB,EAAkC;AAAd,SAAA,MAAA,GAAA,MAAA;AAAkB;;AAEtC,EAAA,uBAAA,CAAA,SAAA,CAAA,MAAA,GAAA,UAAO,GAAP,EAAoB,SAApB,EAAuC;AACrC,SAAK,UAAL,GAAkB,IAAI,SAAJ,CAAc,YAAA,CAAA,OAAA,CAAW,cAAX,CAA0B,GAA1B,CAAd,EAA8C,SAA9C,CAAlB;AACA,SAAK,UAAL,CAAgB,UAAhB,GAA6B,aAA7B;AACD,GAHD;;AAKA,EAAA,uBAAA,CAAA,SAAA,CAAA,IAAA,GAAA,UAAK,OAAL,EAAwB;AAAxB,QAAA,KAAA,GAAA,IAAA;;AACE,QAAI;AACF,WAAK,UAAL,CAAgB,IAAhB,CAAqB,OAAO,CAAC,MAA7B;AACA,aAAO,IAAP;AACD,KAHD,CAGE,OAAO,GAAP,EAAY;AACZ,WAAK,MAAL,CAAY,KAAZ,CACE,YAAA;AACE,eAAA,iBAAe,GAAG,CAAC,OAAnB,GAA0B,oBAA1B,GAA+C,qBAAA,CAAA,OAAA,CAAoB,KAAI,CAAC,UAAL,EAApB,CAA/C;AAAuF,OAF3F;AAIA,aAAO,KAAP;AACD;AACF,GAXD;;AAaA,EAAA,uBAAA,CAAA,SAAA,CAAA,KAAA,GAAA,UAAM,IAAN,EAAqB,MAArB,EAAoC;AAClC,SAAK,UAAL,CAAgB,KAAhB,CAAsB,IAAtB,EAA4B,MAA5B;AACD,GAFD;;AAIA,EAAA,uBAAA,CAAA,SAAA,CAAA,OAAA,GAAA,YAAA;AACE,SAAK,UAAL,GAAkB,IAAlB;AACD,GAFD;;AAIA,EAAA,uBAAA,CAAA,SAAA,CAAA,gBAAA,GAAA,UAAiB,OAAjB,EAAkC,aAAlC,EAA8D;AAC5D,SAAK,UAAL,CAAgB,gBAAhB,CAAiC,OAAjC,EAA0C,aAA1C;AACD,GAFD;;AAIA,EAAA,uBAAA,CAAA,SAAA,CAAA,UAAA,GAAA,YAAA;AACE,QAAI,CAAC,KAAK,UAAV,EAAsB;AACpB,aAAO,qBAAA,CAAA,OAAA,CAAoB,IAA3B;AACD;;AACD,YAAQ,KAAK,UAAL,CAAgB,UAAxB;AACE,WAAK,SAAS,CAAC,UAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,UAA3B;;AACF,WAAK,SAAS,CAAC,IAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,IAA3B;;AACF,WAAK,SAAS,CAAC,OAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,OAA3B;;AACF,WAAK,SAAS,CAAC,MAAf;AACE,eAAO,qBAAA,CAAA,OAAA,CAAoB,MAA3B;AARJ;AAUD,GAdD;;AAeF,SAAA,uBAAA;AAAC,CAlDD,EAAA","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright 2019-2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Versioning_1 = require(\"../versioning/Versioning\");\nvar WebSocketReadyState_1 = require(\"./WebSocketReadyState\");\nvar DefaultWebSocketAdapter = /** @class */ (function () {\n    function DefaultWebSocketAdapter(logger) {\n        this.logger = logger;\n    }\n    DefaultWebSocketAdapter.prototype.create = function (url, protocols) {\n        this.connection = new WebSocket(Versioning_1.default.urlWithVersion(url), protocols);\n        this.connection.binaryType = 'arraybuffer';\n    };\n    DefaultWebSocketAdapter.prototype.send = function (message) {\n        var _this = this;\n        try {\n            this.connection.send(message.buffer);\n            return true;\n        }\n        catch (err) {\n            this.logger.debug(function () {\n                return \"send error: \" + err.message + \", websocket state=\" + WebSocketReadyState_1.default[_this.readyState()];\n            });\n            return false;\n        }\n    };\n    DefaultWebSocketAdapter.prototype.close = function (code, reason) {\n        this.connection.close(code, reason);\n    };\n    DefaultWebSocketAdapter.prototype.destroy = function () {\n        this.connection = null;\n    };\n    DefaultWebSocketAdapter.prototype.addEventListener = function (handler, eventListener) {\n        this.connection.addEventListener(handler, eventListener);\n    };\n    DefaultWebSocketAdapter.prototype.readyState = function () {\n        if (!this.connection) {\n            return WebSocketReadyState_1.default.None;\n        }\n        switch (this.connection.readyState) {\n            case WebSocket.CONNECTING:\n                return WebSocketReadyState_1.default.Connecting;\n            case WebSocket.OPEN:\n                return WebSocketReadyState_1.default.Open;\n            case WebSocket.CLOSING:\n                return WebSocketReadyState_1.default.Closing;\n            case WebSocket.CLOSED:\n                return WebSocketReadyState_1.default.Closed;\n        }\n    };\n    return DefaultWebSocketAdapter;\n}());\nexports.default = DefaultWebSocketAdapter;\n//# sourceMappingURL=DefaultWebSocketAdapter.js.map"]},"metadata":{},"sourceType":"script"}