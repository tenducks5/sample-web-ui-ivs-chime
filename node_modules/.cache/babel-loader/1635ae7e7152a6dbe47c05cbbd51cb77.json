{"ast":null,"code":"\"use strict\"; // Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar JPEGDecoder_1 = require(\"../webassembly/JPEGDecoder\");\n\nvar DefaultJPEGDecoderInstance =\n/** @class */\nfunction () {\n  function DefaultJPEGDecoderInstance(module, controller, width, height) {\n    this.decoder = null;\n    this.controller = null;\n    this.controller = controller;\n    this.decoder = new JPEGDecoder_1.default(module, width, height);\n  }\n\n  DefaultJPEGDecoderInstance.prototype.free = function () {\n    this.decoder.free();\n    this.decoder = null;\n    this.controller = null;\n  };\n\n  DefaultJPEGDecoderInstance.prototype.decodeToImageData = function (inputArray) {\n    if (this.controller.isInputTooLarge(inputArray.length)) {\n      throw new Error('buffer too large for jpeg decoder input buffer: ' + inputArray.length + ' bytes');\n    }\n\n    var b = this.controller.newInternalInputView();\n    var d = inputArray;\n    var n = d.length;\n    var i = 0;\n\n    for (i = 0; i < n; i++) {\n      b[i] = d[i];\n    }\n\n    var result = this.decoder.decode(this.controller.inputPointer(), inputArray.length);\n\n    if (!result) {\n      throw new Error('jpeg decoder failed for input: ' + inputArray);\n    }\n\n    var actualWidth = this.decoder.width();\n    var actualHeight = this.decoder.height();\n    var actualBytes = actualWidth * actualHeight * 4;\n    var buffer = this.controller.newInternalOutputView(this.decoder.outputPointer(), actualBytes);\n    return new ImageData(buffer, actualWidth, actualHeight);\n  };\n\n  return DefaultJPEGDecoderInstance;\n}();\n\nexports.default = DefaultJPEGDecoderInstance;","map":{"version":3,"sources":["../../../src/jpegdecoder/instance/DefaultJPEGDecoderInstance.ts"],"names":[],"mappings":"cAAA;AACA;;;;;;AAGA,IAAA,aAAA,GAAA,OAAA,CAAA,4BAAA,CAAA;;AAGA,IAAA,0BAAA;AAAA;AAAA,YAAA;AAIE,WAAA,0BAAA,CACE,MADF,EAEE,UAFF,EAGE,KAHF,EAIE,MAJF,EAIgB;AAPR,SAAA,OAAA,GAA8B,IAA9B;AACA,SAAA,UAAA,GAAkD,IAAlD;AAQN,SAAK,UAAL,GAAkB,UAAlB;AACA,SAAK,OAAL,GAAe,IAAI,aAAA,CAAA,OAAJ,CAAgB,MAAhB,EAAwB,KAAxB,EAA+B,MAA/B,CAAf;AACD;;AAED,EAAA,0BAAA,CAAA,SAAA,CAAA,IAAA,GAAA,YAAA;AACE,SAAK,OAAL,CAAa,IAAb;AACA,SAAK,OAAL,GAAe,IAAf;AACA,SAAK,UAAL,GAAkB,IAAlB;AACD,GAJD;;AAMA,EAAA,0BAAA,CAAA,SAAA,CAAA,iBAAA,GAAA,UAAkB,UAAlB,EAAwC;AACtC,QAAI,KAAK,UAAL,CAAgB,eAAhB,CAAgC,UAAU,CAAC,MAA3C,CAAJ,EAAwD;AACtD,YAAM,IAAI,KAAJ,CACJ,qDAAqD,UAAU,CAAC,MAAhE,GAAyE,QADrE,CAAN;AAGD;;AACD,QAAM,CAAC,GAAG,KAAK,UAAL,CAAgB,oBAAhB,EAAV;AACA,QAAM,CAAC,GAAG,UAAV;AACA,QAAM,CAAC,GAAG,CAAC,CAAC,MAAZ;AACA,QAAI,CAAC,GAAG,CAAR;;AACA,SAAK,CAAC,GAAG,CAAT,EAAY,CAAC,GAAG,CAAhB,EAAmB,CAAC,EAApB,EAAwB;AACtB,MAAA,CAAC,CAAC,CAAD,CAAD,GAAO,CAAC,CAAC,CAAD,CAAR;AACD;;AACD,QAAM,MAAM,GAAG,KAAK,OAAL,CAAa,MAAb,CAAoB,KAAK,UAAL,CAAgB,YAAhB,EAApB,EAAoD,UAAU,CAAC,MAA/D,CAAf;;AACA,QAAI,CAAC,MAAL,EAAa;AACX,YAAM,IAAI,KAAJ,CAAU,oCAAoC,UAA9C,CAAN;AACD;;AACD,QAAM,WAAW,GAAW,KAAK,OAAL,CAAa,KAAb,EAA5B;AACA,QAAM,YAAY,GAAW,KAAK,OAAL,CAAa,MAAb,EAA7B;AACA,QAAM,WAAW,GAAW,WAAW,GAAG,YAAd,GAA6B,CAAzD;AACA,QAAM,MAAM,GAAsB,KAAK,UAAL,CAAgB,qBAAhB,CAChC,KAAK,OAAL,CAAa,aAAb,EADgC,EAEhC,WAFgC,CAAlC;AAIA,WAAO,IAAI,SAAJ,CAAc,MAAd,EAAsB,WAAtB,EAAmC,YAAnC,CAAP;AACD,GAzBD;;AA0BF,SAAA,0BAAA;AAAC,CA9CD,EAAA","sourceRoot":"","sourcesContent":["\"use strict\";\n// Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar JPEGDecoder_1 = require(\"../webassembly/JPEGDecoder\");\nvar DefaultJPEGDecoderInstance = /** @class */ (function () {\n    function DefaultJPEGDecoderInstance(module, controller, width, height) {\n        this.decoder = null;\n        this.controller = null;\n        this.controller = controller;\n        this.decoder = new JPEGDecoder_1.default(module, width, height);\n    }\n    DefaultJPEGDecoderInstance.prototype.free = function () {\n        this.decoder.free();\n        this.decoder = null;\n        this.controller = null;\n    };\n    DefaultJPEGDecoderInstance.prototype.decodeToImageData = function (inputArray) {\n        if (this.controller.isInputTooLarge(inputArray.length)) {\n            throw new Error('buffer too large for jpeg decoder input buffer: ' + inputArray.length + ' bytes');\n        }\n        var b = this.controller.newInternalInputView();\n        var d = inputArray;\n        var n = d.length;\n        var i = 0;\n        for (i = 0; i < n; i++) {\n            b[i] = d[i];\n        }\n        var result = this.decoder.decode(this.controller.inputPointer(), inputArray.length);\n        if (!result) {\n            throw new Error('jpeg decoder failed for input: ' + inputArray);\n        }\n        var actualWidth = this.decoder.width();\n        var actualHeight = this.decoder.height();\n        var actualBytes = actualWidth * actualHeight * 4;\n        var buffer = this.controller.newInternalOutputView(this.decoder.outputPointer(), actualBytes);\n        return new ImageData(buffer, actualWidth, actualHeight);\n    };\n    return DefaultJPEGDecoderInstance;\n}());\nexports.default = DefaultJPEGDecoderInstance;\n//# sourceMappingURL=DefaultJPEGDecoderInstance.js.map"]},"metadata":{},"sourceType":"script"}